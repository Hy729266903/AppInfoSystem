<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cn.appsys.dao.deve.appversion.AppVersionMapper">
	
	<!-- 根据APP的id查询版本列表信息 -->
	<select id="getAppVersionById" resultType="AppVersion">
		SELECT v.*,i.softwareName AS appName,
		(SELECT valueName FROM data_dictionary WHERE typeCode = 'PUBLISH_STATUS' AND valueId = v.publishStatus) AS publishStatusName
		FROM `app_version` v,app_info i WHERE v.appId = i.id and v.appId = #{id}
	</select>
	<!-- 保存修改 -->
	<insert id="insertAppVersion" parameterType="AppVersion">
		INSERT INTO `appinfodb`.`app_version`
            (`appId`,
             `versionNo`,
             `versionInfo`,
             `publishStatus`,
             `downloadLink`,
             `versionSize`,
             `createdBy`,
             `creationDate`,
             `apkLocPath`,
             `apkFileName`)
		VALUES (#{appId},
		        #{versionNo},
		        #{versionInfo},
		        #{publishStatus},
		        #{downloadLink},
		        #{versionSize},
		        #{createdBy},
		        #{creationDate},
		        #{apkLocPath},
		        #{apkFileName})
		<selectKey resultType="java.lang.Integer" keyProperty="id">
            <!-- Mybatis中插入记录后获取该条记录ID -->
            SELECT LAST_INSERT_ID() AS id 
		</selectKey>
	</insert>
</mapper>